<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MundoTEA - Cadastro</title>
  <link rel="icon" type="image/png" href="imagens/logo_mundotea.png">
  <link rel="stylesheet" href="css/estilo-cadastro.css">
</head>
<body class="cadastro-page">

  <div class="cadastro-wrapper">

    <!-- LADO ESQUERDO -->
    <div class="cadastro-side">
      <img src="imagens/loginimg.png" alt="Imagem cadastro">
    </div>

    <!-- LADO DIREITO -->
    <div class="cadastro-box">

      <div class="cadastro-header">
        <img src="imagens/logo_mundotea.png" class="cadastro-logo">
        <h1><span class="mundo">Mundo</span><span class="tea">TEA</span></h1>
      </div>

      <!-- ETAPAS -->
      <div class="cadastro-etapas">
        <span class="etapa ativa" id="et1">Conta</span>
        <span class="etapa oculto" id="et2">Criança</span>
        <span class="etapa oculto" id="et3">Responsáveis</span>
      </div>

      <!-- FORMULÁRIO -->
      <form id="formCadastro">

        <!-- ETAPA 1 - CONTA -->
        <div class="cadastro-step" id="step1">
          <input type="email" id="email" name="email" placeholder="E-mail da criança" required>
          <input type="password" id="senha" name="senha" placeholder="Senha" required>
          <input type="password" id="confirmar_senha" name="confirmar_senha" placeholder="Confirmar senha" required>
          <button type="button" class="cadastro-btn" onclick="validarEtapa1()">Avançar</button>
        </div>

        <!-- ETAPA 2 - CRIANÇA -->
        <div class="cadastro-step oculto" id="step2">
          <input type="text" id="nome_crianca" name="nome_crianca" placeholder="Nome da criança" required>
          <input type="date" id="data_nasc" name="data_nasc" required>
          <select id="nivel_autismo" name="nivel_autismo" required>
            <option value="" disabled selected>Nível de autismo</option>
            <option value="1">Suporte Nível 1</option>
            <option value="2">Suporte Nível 2</option>
            <option value="3">Suporte Nível 3</option>
          </select>
          <textarea id="necessidades" name="necessidades" placeholder="Necessidades específicas (opcional)"></textarea>

          <div class="botoes">
            <button type="button" class="cadastro-btn voltar" onclick="irParaEtapa(1)">Voltar</button>
            <button type="button" class="cadastro-btn" onclick="irParaEtapa(3)">Avançar</button>
          </div>
        </div>

        <!-- ETAPA 3 - RESPONSÁVEIS -->
        <div class="cadastro-step oculto" id="step3">
          <input type="text" id="suporte1" name="suporte1" placeholder="Nome do responsável 1" required>
          <input type="text" id="suporte2" name="suporte2" placeholder="Nome do responsável 2" required>
          <input type="text" id="telefone" name="telefone" placeholder="Telefone" required>
          <input type="email" id="email_resp" name="email_resp" placeholder="E-mail do responsável" required>

          <div class="botoes">
            <button type="button" class="cadastro-btn voltar" onclick="irParaEtapa(2)">Voltar</button>
            <button type="submit" class="cadastro-btn salvar">Finalizar Cadastro</button>
          </div>
        </div>

      </form>

      <div class="cadastro-footer">
        <p>Já possui conta? <a href="login.html">Entrar</a></p>
      </div>

    </div>
  </div>

<script>
function irParaEtapa(num) {
  document.querySelectorAll(".cadastro-step").forEach(el => el.classList.add("oculto"));
  document.querySelectorAll(".etapa").forEach(el => el.classList.remove("ativa"));

  document.getElementById("step" + num).classList.remove("oculto");
  document.getElementById("et" + num).classList.add("ativa");
}

function validarEtapa1() {
  const senha = document.getElementById("senha").value;
  const confirmar = document.getElementById("confirmar_senha").value;

  if (senha !== confirmar) {
    alert("As senhas não coincidem!");
    return;
  }

  irParaEtapa(2);
}

document.getElementById("formCadastro").addEventListener("submit", async function(e){
  e.preventDefault();

  // Coleta os dados do formulário
  const dados = {
    tipo_usuario: "crianca",
    email: document.getElementById("email").value.trim(),
    senha: document.getElementById("senha").value.trim(),
    nome_crianca: document.getElementById("nome_crianca").value.trim(),
    data_nascimento: document.getElementById("data_nasc").value,
    nivel_autismo: document.getElementById("nivel_autismo").value,
    necessidades: document.getElementById("necessidades").value.trim(),
    pai: document.getElementById("suporte1").value.trim(),
    mae: document.getElementById("suporte2").value.trim(),
    telefone_resp: document.getElementById("telefone").value.trim(),
    email_resp: document.getElementById("email_resp").value.trim()
  };

  try {
    const response = await fetch("http://localhost:5000/registrar", {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify(dados)
    });

    const resData = await response.json();

    if(response.ok){
      alert("Cadastro realizado com sucesso!");
      window.location.href = "login.html";
    } else {
      alert(resData.erro || "Erro ao cadastrar criança.");
    }

  } catch(err){
    console.error("Erro API:", err);
    alert("Não foi possível conectar à API.");
  }
});
</script>

</body>
</html>
